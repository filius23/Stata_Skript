[
["dataviz.html", "5 Datenvisualisierung in Stata 5.1 Grafik-Syntax in Stata 5.2 Beispiele zum selbst anpassen 5.3 Abschließende Bemerkungen 5.4 Bevölkerungspyramide 5.5 Anhang", " 5 Datenvisualisierung in Stata Wir starten wie immer mit dem Einlesen eines Datensatzes: cd &quot;...&quot; use &quot;Allbus_2018.dta&quot;, clear replace inc = . if inc &lt; 0 replace age = . if age &lt; 0 sample 25 //25% Stichprobe aus den Daten -&gt; läuft schneller Für Grafiken gilt noch mehr als für alle anderen Aspekte in Stata: ausprobieren und sehen, was passiert! Nachdem in der Regel ja zumindest eine ungefähre Vorstellung existiert, wie die zu erstellende Grafik aussehen soll, sind Grafik-Gallerieren ein guter Startpunkt das eigene Trial &amp; Error. Die größte Herausforderung ist häufig, eine Vorstellung zu entwickeln, wie die Darstellung aussehen soll. Eine Übersicht zu allen verfügbaren Visualierungen inklusive Beispielbefehlen findet sich beispielsweise hier oder hier. 5.1 Grafik-Syntax in Stata Die Syntax für Graphiken in Stata unterscheidet sich vom dem bisher Kennengelernten. 5.1.1 Aufbau Grafik-Befehle bestehen aus zwei Teilen: dem Befehl graph und der Angabe eines Grafik-Typs. Im folgenden Befehl ist box der Grafik-Typ: graph box inc 5.1.2 twoway Beim Grafik-Typ twoway muss der sog. Plottyp, spezifiziert werden. Bspw. für ein Streudiagramm mit dem Befehl scatter: graph twoway scatter inc age 5.1.3 Kombinieren von zwei twoway-Grafiken twoway-Grafiken können übereinander gelegt werden. So können wir durch Kombination der Plottypen scatter und lfit ein Streudiagram mit einer Regressionsgerade1 kombinieren: graph twoway (scatter inc age) (lfit inc age) Eine alternative Schreibweise mit || führt zur gleichen Grafik: graph twoway scatter inc age || lfit inc age 5.1.4 twoway Varianten graph twoway scatter hatten wir jetzt schon kennen gelernt. Natürlich gibt es aber auch noch weitere Darstellungsformen. graph twoway bar liefert uns ein Säulendiagramm: Mit der Option ,horizontal können wir dieses Säulendiagramm in ein Balkendiagramm mit horizontalen Balken verwandeln: Mit graph twoway connected bekommen wir ein Punktdiagramm mit verbundenen Punkten 5.1.5 Vorlagen Das Aussehen von Grafiken wird durch sog. Grafik-Schemata beeinflusst. Beispielsweise wird mit , scheme(sj) die Grafik nach den Vorlage des Stata Journals erstellt: graph twoway (scatter inc age) (lfit inc age), scheme(sj) Mit graph query, schemes wird eine Liste der verfügbaren Schemata angezeigt. Weitere Optionen bieten zB die blindschemes von Daniel Bischof oder lean2 von Svend Juul. Beide müssen zunächst mit ssc install blindschemes bzw. net install gr0002_3, from(\"http://www.stata-journal.com/software/sj4-3\") installiert werden und stehen dann zur Verfügung, zB Hier noch ein Beispiel mit plotplain aus blindschemes: graph twoway (scatter inc age) (lfit inc age), scheme(plotplain) legend(cols(2) pos(6)) …und lean2: graph twoway (scatter inc age) (lfit inc age), scheme(lean2) /// 5.1.6 Optionen Darüber hinaus kann die Grafik mit Hilfe von spezifischen Optionen angepasst werden. legend pos labeln Achsenoptionen xlabel, ylabel, xtitle over Darstellungstypen Symbole/Linientypen Farboptionen mcolor, lcolor, graphregion(color(orange)) Optionen von graph können Unteroptionen haben oder aus einer Liste von Optionen zusammengesetzt werden. Hier zwei Beispiele: xlabel(#20, angle(90)) oder xscale(range(0 300) reverse alt). 5.1.7 Farben Obwohl es um Darstellungen geht, haben wir noch sehr wenig über Farben gesprochen. Instagram ColorBrewer colorhex 5.1.8 Subgruppen graph twoway ( scatter inc age if sex == 1 , mc(&quot;0 62 81&quot;) msymbol(o) ) ( scatter inc age if sex == 2 , mc(&quot;254 216 128&quot;) msymbol(o) ) /// graph twoway ( scatter inc age if sex == 1 , mc(&quot;0 62 81&quot;) msymbol(o) ) ( scatter inc age if sex == 2 , mc(&quot;254 216 128&quot;) msymbol(o) ) ( lfit inc age if sex == 1 , lc(&quot;black&quot;) ) ( lfit inc age if sex == 2 , lc(&quot;orange&quot;) msymbol(o) ) /// 5.2 Beispiele zum selbst anpassen Hier noch ein Beispiel mit (sehr) vielen Optionen als Vorlage für eigene Anpassungen (DoFile): graph box inc_m inc_f, over(age_c) scheme(lean1) box(1, color(&quot;0 41 93&quot;)) marker(1, mcolor(&quot;0 41 93&quot;) msymbol(&quot;o&quot;) ) medline(lcolor(&quot;204 175 105&quot;)) box(2, color(&quot;146 143 107&quot;)) marker(2, mcolor(&quot;146 143 107&quot;) msymbol(&quot;o&quot;) ) legend(cols(2) pos(12) region(fcolor(&quot;249 247 241&quot;) lcolor(&quot;16 74 138&quot;))) ytitle(&quot;{stSerif:Einkommen}{superscript:2018}&quot;) b1title(&quot;Alter&quot;) title(&quot;Einkommen&quot;) caption(&quot;{bf:Quelle}: Allbus 2018 {it:eigene Berechnungen}&quot;,position(5)) plotregion(fcolor(&quot;252 251 248&quot;)) graphregion(fcolor(&quot;249 247 241&quot;)) Auch die Darstellung auf der Startseite dieses Skripts wurde als Stata-Grafik erstellt: webuse bpwide, clear graph twoway (lfit bp_before bp_after) ( scatter bp_before bp_after if agegrp == 1, mc(&quot;0 62 81&quot;) msymbol(o) ) ( scatter bp_before bp_after if agegrp == 2, mc(&quot;0 125 186&quot;) msymbol(o) ) ( scatter bp_before bp_after if agegrp == 3, mc(&quot;214 210 196&quot;) msymbol(o) ), scheme(lean2) legend(off) xtitle(&quot;&quot;) 5.3 Abschließende Bemerkungen Häufig ist die größte Herausforderung, die Daten so umzustellen, dass sie zum gewünschten graph-Befehl passen. Ein Beispiel ist die Erstellung einer Bevölkerungspyramide aus den Allbusdaten: 5.4 Bevölkerungspyramide Auch eine Bevölkerungspyramide lässt sich als Stata-Grafik erstellen. Allerdings müssen dazu einige Zwischenschritte durchlaufen, die fortgeschrittene Datenaufbereitung mit collapse voraussetzen. Außerdem könnte ein Teil der Aufbereitung mit reshape abgekürzt werden. Mehr Informationen dazu finden sich am Ende dieses Skripts in Kapitel 11. Die grundsätzliche Funktion für die Bevölkerungspyramide ist ein Balkendiagramm mit graph twoway bar , horizontal. Die Länge der Balken soll jeweils durch die Anzahl der Fälle in jeder Altersstufe, getrennt nach Geschlecht, bestimmt werden. Dazu müssen wir also zunächst die Anzahl der Befragten pro Alterstufe und Geschlecht bestimmen. Wenn wir den Allbus 2018 laden, haben wir ja einen Datensatz mit einer Zeile pro Person. Was wir jetzt aber benötigen ist eine Variante, in der wir den Datensatz sozusagen “zusammenschieben”: wir brauchen jeweils eine Zeile pro Altersstufe und Geschlecht und eine Variable mit der Zahl der Befragten. age sex Anzahl_Befragte 1 18 1 15 2 18 2 11 3 19 1 22 4 19 2 15 5 20 1 18 6 20 2 16 Um dorthin zu kommen, steht uns der collapse-Befehl zur Verfügung: cd &quot;&quot; use &quot;Allbus_2018.dta&quot;, clear tab agec keep if sex &gt; 0 keep if agec &gt; 0 collapse (count) respid , by(sex age) list in 1/8 Unter respid ist jetzt die Zahl der Befragten in der jeweiligen Kombination aus age und sex abgelegt: age sex respid 1 18 1 15 2 18 2 11 3 19 1 22 4 19 2 15 5 20 1 18 6 20 2 16 7 21 1 21 8 21 2 13 Um verwirrung zu vermeiden, benennen wir respid in total um: rename respid total Allerdings möchten wir jetzt die Angaben für Frauen und Männer in getrennte Variablen ablegen: gen total_m = total if sex == 1 gen total_f = total if sex == 2 list in 1/10 age sex total total_m total_f 1 18 1 15 15 . 2 18 2 11 . 11 3 19 1 22 22 . 4 19 2 15 . 15 5 20 1 18 18 . 6 20 2 16 . 16 7 21 1 21 21 . 8 21 2 13 . 13 9 22 1 18 18 . 10 22 2 15 . 15 Jetzt können wir daraus ein Balkendiagramm erstellen: twoway( bar neg_total_m age, horizontal )(bar total_f age, horizontal) Was hier noch fehlt ist, die Umorientierung der Zahlen für die Männer “nach links”. Dazu multiplizieren wir total_m mit -1: gen neg_total_m = -total_m Damit dann verwenden wir neg_total_m für die Balken der Männer: twoway( bar neg_total_m age, horizontal )(bar total_f age, horizontal) Mit xlabel und legendnoch einige Anpassungen, außerdem können wir mit text noch Beschriftungen hinzufügen: twoway( bar neg_total_m age, horizontal )(bar total_f age, horizontal) ,xlabel( -40 &quot;40&quot; -30 &quot;30&quot; -20 &quot;20&quot; -10 &quot;10&quot; 0 10(10)40 ) legend(off) text(100 -8 &quot;Männer&quot;) text(100 8 &quot;Frauen&quot;) 5.5 Anhang 5.5.1 Aufbereitung für Boxplot use &quot;D:\\Studium\\01_Oldenburg\\Lehre\\Datensaetze\\Allbus_2018.dta&quot;, clear replace inc = . if inc &lt; 0 replace age = . if age &lt; 0 egen age_c = cut(age), at(20,35,50,65) lab def agec1 20 &quot;20-34&quot; 35 &quot;35-49&quot; 50 &quot;50-64&quot; lab val age_c agec1 gen inc_m = inc if sex == 1 gen inc_f = inc if sex == 2 lab var inc_m &quot;Männer&quot; lab var inc_f &quot;Frauen&quot; Was das genau ist, werden wir am Donnerstag besprechen. Für den Moment nur so viel: die Gerade gibt den Zusammenhangstrend beider Variablen wieder.↩︎ "]
]
